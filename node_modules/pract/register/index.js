var express = require('express');
var connection = require('./db.js');
var app = express();
var bodyParser = require('body-parser');

var urlencodedParser = bodyParser.urlencoded({ extended: false })



app.use(express.static("public"));
app.set('view engine', 'ejs');
app.set('views', './public/views');




app.get('/insert', function (req, res) {
           res.render('insert', {
                
           });
       });

app.get('/index', function (req, res) {
           res.render('index', {
                
           });
       });
app.get('/delete', function (req, res) {
           res.render('delete', {
                
           });
       });




app.get('/update', function (req, res) {
           res.render('update', {
                
           });
       });


app.get('/getpaneldetails', function (req, res) {
           res.render('getpaneldetails', {
                
           });
       });



app.get('/select', function (req, res) {
    connection.query('SELECT * FROM student',
       function (err, result) {
           if (err) throw err;
           res.render('select', {
                users: result
           });
       });
});

app.post('/insert', urlencodedParser, function (req, res) {
   
    var sql = 'INSERT INTO student (`fname`,`lname`, `email`, `password`) VALUES ("' + req.body.fname + '", "' + req.body.lname + '","' + req.body.email + '", "' + req.body.pass + '") ';
    connection.query(sql,
        function (err, result) {
            if (err) throw err;
            res.writeHead(302,
              { Location: '/select' }
            );
            res.end();
        }
    );
});

app.post('/update', urlencodedParser, function (req, res) {
  
   // var sql = 'UPDATE student SET fname = "'+req.body.txtupdate+'" WHERE sid = "'+req.body.txtid+'"';
    var sql = 'UPDATE student SET fname = "'+ req.body.txtupdate +'" WHERE sid="'+ req.body.txtid +'"';
    connection.query(sql,
        function (err, result) {
            if (err) throw err;
            res.writeHead(302,
              { Location: '/select' }
            );
            res.end();
        }
    );
});

app.post('/delete', urlencodedParser, function (req, res) {
  
   // var sql = 'DELETE FROM student WHERE fname="'+req.body.txtid+'"';
   var sql = 'DELETE FROM student WHERE sid="'+req.body.txtid+'"';
    connection.query(sql,
        function (err, result) {
            if (err) throw err;
            res.writeHead(302,
              { Location: '/select' }
            );
            res.end();
        }
    );
});


app.post('/update1', urlencodedParser, function (req, res) {
    var sql = 'select * from student where sid= "'+req.body.id+'"';
    connection.query(sql,
        function (err, result) {
     if (err) throw err;
           res.render('update', {
                users: result
           });
       });
  });


app.listen(3000);