var express = require('express');
var connection = require('./db.js');
var app = express();
var bodyParser = require('body-parser');

var urlencodedParser = bodyParser.urlencoded({ extended: false })



app.use(express.static("public"));
app.set('view engine', 'ejs');
app.set('views', './public/views');




app.get('/', function (req, res) {
           res.render('insert', {
                
           });
       });

app.get('/index', function (req, res) {
           res.render('index', {
                
           });
       });



app.get('/select', function (req, res) {
    connection.query('SELECT * FROM user',
       function (err, result) {
           if (err) throw err;
           res.render('select', {
                users: result
           });
       });
});

app.post('/insert', urlencodedParser, function (req, res) {
   
  var sql = 'INSERT INTO user (`uname`,`image`) VALUES ("' + req.body.uname + '", "' + req.body.fileToUpload + '") ';
    connection.query(sql,
        function (err, result) {
            if (err) throw err;
            res.writeHead(302,
              { Location: '/select' }
            );
            res.end();
        }
    );
});



app.listen(3000);