var express = require('express');
var connection = require('./db.js');
var app=express();
var bodyParser = require('body-parser');
// Create application/x-www-form-urlencoded parser
var urlencodedParser = bodyParser.urlencoded({ extended: false })


//app.use('/insert',things);
app.use(express.static("public"));
app.set('view engine', 'ejs');
app.set('views', './public/views');




app.get('/insert', function (req, res) {
           res.render('insert', {
                
           });
       });

app.get('/getpaneldetails', function (req, res) {
           res.render('getpaneldetails', {
                
           });
       });








app.get('/index', function (req, res) {
           res.render('index', {
                
           });
       });
app.get('/delete', function (req, res) {
           res.render('delete', {
                
           });
       });




app.get('/update', function (req, res) {
           res.render('update', {
                
           });
       });


// Set 'views' directory for any views 
// being rendered res.render()

//app.set('views', './we999b/views');


app.get('/select', function (req, res) {
    connection.query('SELECT * FROM employee',
       function (err, result) {
           if (err) throw err;
           res.render('select', {
                users: result
           });
       });
});

app.post('/insert', urlencodedParser, function (req, res) {
   
    var sql = 'INSERT INTO `employee`( `epass`,`empname`, `empaddress`, `emphone`, `empgender`,`mailid`) VALUES ("'+req.body.epass+'","'+req.body.ename+'","'+req.body.eaddress+'","'+req.body.ephone+'","'+req.body.egender+'","'+req.body.email+'")';
    connection.query(sql,
        function (err, result) {
            if (err) throw err;
            res.writeHead(302,
              { Location: '/select' 
            }
            );
            res.end();
        }
    );
});

app.post('/update', urlencodedParser, function (req, res) {
    var sql = 'update employee set empaddress="'+req.body.eaddr+'" where mailid= "'+req.body.mail+'"';
    connection.query(sql,
        function (err, result) {
            if (err) throw err;
            res.writeHead(302,
              { Location: '/update' }
            );
            res.end();
        }
    );
});

app.post('/delete', urlencodedParser, function (req, res) {
  
    var sql = 'delete from employee where empname="'+req.body.ename+'"';
    connection.query(sql,
        function (err, result) {
            if (err) throw err;
            res.writeHead(302,
              { Location: '/select' }
            );
            res.end();
        }
    );
});

app.post('/update1', urlencodedParser, function (req, res) {
    var sql = 'select * from employee where mailid= "'+req.body.mail+'"';
    connection.query(sql,
        function (err, result) {
     if (err) throw err;
           res.render('update', {
                users: result
           });
       });
  });















app.listen(8080);
